pipeline {
    agent any
    environment {
        bucket = "sam-jenkins-demo-us-east-2-ranaziauddin"
        region = "us-east-2"
        aws_credential = "AWSReservedSSO_AdministratorAccess_564bcbbbca5e5655/rzdin@enquizit.com"
        application_name = "Nodejs"
       
       
    }
     stages{
        stage("Nodejs build"){
            tools {nodejs "NODEJS"}
            steps {
                sh 'rm -rf *.zip'
                sh "npm install"
               
               
    
                sh "zip 'myapp.zip' db jenkinsfile  model  node_modules/*  README.md utils handler  LICENSE myapp  package.json  serverless.yml"
                sh def fn = "myapp.zip""
                sh def today = new Date()"
                sh def c = new GregorianCalendar()
                sh def sdf = new java.text.SimpleDateFormat("yyyyMMddhhmmss")

                // add a timestamp to the file
                sh fn = fn.replace(".", "-" + sdf.format(today) + ".")
                
              }
  }
       stage("Upload"){
            steps{
                withAWS(credentials: "${aws_credential}", region: "${region}"){
                s3Upload(file:"myapp_${NOW}.zip", bucket:"${bucket}")
               
                  }
            }
     post { 
        always { 
            archiveArtifacts artifacts: '*.zip'
         }
       }
    }  
 }
}
