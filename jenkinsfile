pipeline {
    agent any
    environment {
        bucket = "sam-jenkins-demo-us-east-2-ranaziauddin"
        region = "us-east-2"
        aws_credential = "AWSReservedSSO_AdministratorAccess_564bcbbbca5e5655/rzdin@enquizit.com"
        application_name = "Nodejs"
       
    }
     stages{
        stage("Nodejs build"){
            tools {nodejs "NODEJS"}
            steps {
                sh 'rm -rf *.zip'
                sh "npm install"
                pipeline {
    agent any
    environment {
        bucket = "sam-jenkins-demo-us-east-2-ranaziauddin"
        region = "us-east-2"
        aws_credential = "AWSReservedSSO_AdministratorAccess_564bcbbbca5e5655/rzdin@enquizit.com"
        application_name = "Nodejs"
       
    }
     stages{
        stage("Nodejs build"){
            tools {nodejs "NODEJS"}
            steps {
                sh 'rm -rf *.zip'
                sh "npm install"
               
               
    
                sh 'zip archive: true, dir: '/var/lib/jenkins/workspace/my-package-jenkins-job', glob: '', zipFile: 'myapp.zip'
               
                  
        }
}
        stage("Upload"){
            steps{
                withAWS(credentials: "${aws_credential}", region: "${region}"){
                s3Upload(file:"myapp-${BUILD_TIMESTAMP}-${BUILD_NUMBER}-${TAG_NAME}.zip", bucket:"${bucket}")
               
                  }
            }
        }
     }  
    }
               
                  
        }
}
        stage("Upload"){
            steps{
                withAWS(credentials: "${aws_credential}", region: "${region}"){
                s3Upload(file:"myapp-${BUILD_TIMESTAMP}-${BUILD_NUMBER}-${TAG_NAME}.zip", bucket:"${bucket}")
               
                  }
            }
        }
     }  
    }



