
pipeline {
    agent any
    environment {
        bucket = "sam-jenkins-demo-us-west-2-rana-ziauddin"
        bucket1 = "sam-jenkins-demo-us-east-2-ranaziauddin"
        region = "us-east-1"
        region1 = "us-east-2"
        aws_credential = "AWSReservedSSO_AdministratorAccess_564bcbbbca5e5655/rzdin@enquizit.com"
        application_name = "Nodejs"
        
       
       
    }
     stages{
          stage ('Copy Build Artifact') {
            steps {
                    withAWS(credentials: "${aws_credential}", region: "${region1}"){
                    sh "ls && pwd"
               bash '''
                    #!/bin/bash
                    $s3location = "s3://{$bucket}/${TAG_NAME_DEV}/"
                    $files = $(aws s3 ls ${bucket1}/${TAG_NAME_DEV}/ --recursive | sort | select -last 1)
                   

                   foreach ($s3FileInfo in $files) {
                        $filename = $s3FileInfo.Split()[-1]
                        $path = "${s3location}/${TAG_NAME_DEV}/"
                        aws s3 cp $path .
                        echo("Done downloading ${path} to ${dlPath}")
}
         '''
}
                    
                    
                  }
              
                         
              }   
        }
            
  }
 } 
