
pipeline {
    agent any
    environment {
        bucket = "sam-jenkins-demo-us-west-2-rana-ziauddin"
        bucket1 = "sam-jenkins-demo-us-east-2-ranaziauddin"
        region = "us-east-1"
        region1 = "us-east-2"
        aws_credential = "AWSReservedSSO_AdministratorAccess_564bcbbbca5e5655/rzdin@enquizit.com"
        application_name = "Nodejs"
           
        
       
       
    }
     stages{
          stage ('Copy Build Artifact') {
            steps {
                    withAWS(credentials: "${aws_credential}", region: "${region1}"){
                           
                            sh'''#!/bin/bash 
                            echo "LINE 1 *****************"
                            rm -rf *.zip
                            ls && pwd
                            echo "LINE 2 *****************"
                            aws s3 ls s3://$bucket1/$TAG_NAME_DEV/  --recursive
                        
                            echo "LINE 3 *****************"
                            file_NAME=`(aws s3 ls s3://$bucket1/$TAG_NAME_DEV/  --recursive | sort | tail -n 1 | awk '{print \$4}')`
                           
                            
                            echo "LINE 4 *****************"
                            echo $file_NAME
                      
                            aws s3 cp s3://$bucket1/$file_NAME  . 
                           
                        '''
                        }
                    
                    
                  }
              
                         
              } 
         stage('unzipfile'){
            steps{
                    sh """
                    rm -r file_extracted_$TAG_NAME_DEV
                    mkdir file_extracted_$TAG_NAME_DEV
                    unzip -o '*_${TAG_NAME_DEV}.zip' -d file_extracted_$TAG_NAME_DEV
                    """
                    
                    
          
        }
     }
         stage('uploading'){
            steps{
                    withAWS(credentials: "${aws_credential}", region: "${region}"){
                      
                       s3Upload(file:"file_extracted_*", bucket:"${bucket}/${TAG_NAME_DEV}")
                    
                    
                    }
          
        }
     }
  }
  }
  
